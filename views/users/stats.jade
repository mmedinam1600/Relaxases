extends ../Layout_Users_Stats.jade
block content
    h1 Bienvenido de Nuevo #{user.nombre}
    h5 #{user.email}
    h2#titulo Ingrese su Dedo en el Lector para Inciar
    div(class="container")
        canvas(id="myCanvas")
        script.
            let level=0, FinalLevel=0;
            const socket = io();
            let counter=0, scount=0;
            socket.on('Grafica:data', function(dataSerial){
                console.log(dataSerial);
                myChart.data.labels.push(counter.toFixed(2));
                myChart.data.datasets.forEach(dataset => {
                    dataset.data.push(dataSerial.value);
                });
                counter+=0.05;
                scount++;
                level+=parseInt(dataSerial.value);
                myChart.update();
                document.getElementById("titulo").innerHTML = "Nivel de %SPO2: " + dataSerial.value.toString();
                if(scount>=300)
                {
                    socket.disconnect();
                    FinalLevel=(level/300).toFixed(2);
                    if(FinalLevel<95)
                    {
                        document.getElementById("estres").innerHTML = "Su nivel de Saturación de Oxigeno es bajo. Es porbable que tenga un ataque de estres";
                    }
                    else
                    {
                        document.getElementById("estres").innerHTML = "Su nivel de Saturación de Oxigeno se encuentra estable.";
                    }
                    popup();
                    document.getElementById("percent").innerHTML = "Nivel Promedio de %SPO2: " + FinalLevel.toString();
                    function popup() {
                    $('.modal').modal();
                    $('#modal1').modal('open');
                    $('.trigger-modal').modal();
                    }

                }
            });


            var ctx = document.getElementById('myCanvas').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Serial'],
                    datasets: [{
                        label: 'Serial',
                        backgroundColor: '#FFFFFF',
                        borderColor: '#FF0000',
                        data: [],
                        pointRadius: 0
                    }]
                },
                options: {}
            });
    
    #modal1.modal
      .modal-content
        h4#percent Modal Header
        p#estres A bunch of text
      .modal-footer
        a.modal-close.waves-effect.waves-green.btn-flat(href='#!') De Acuerdo



